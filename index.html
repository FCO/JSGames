<html>
  <head>
  </head>
  <body>
    <script src="./gameFisics.js"></script>
    <script>
      var screen                   = new Screen(document.body);
      screen.has_gravity(0, 10);
      screen.color                 = "FFFFFF";
      screen.width                 = 800;
      screen.height                = 500;
      screen.dom.style.border      = "solid 1px black";
      screen.dom.style.cursor      = "none";

      var score = screen.createElement("Score");
      score.x = 10;
      score.y = 10;
      score.set_point_type("block", 1);
      score.set_point_type("ghost", {time: 30000});

      var quad                     = screen.createElement("Poligon");
      //quad.bounce_when_colide_with = ["Border"];
      //quad.draw_colision_area      = true;
      quad.solid                   = true;
      //quad.do_not_colide_with      = ["Border"];
      quad.type                    = "Barra";
      quad.color                   = "000000";
      quad.add_vertice(-25, 0);
      quad.add_vertice(25, 0);
      quad.add_vertice(25, 5);
      quad.add_vertice(-25, 5);
      quad.x                       = screen.width / 2;
      quad.y                       = 450;
      quad.on_colide_with("ball", function(bola) { 
         bola.velocity.ang += (bola.center.x - this.center.x) / 100;
         if(bola.velocity.y > 0) bola.velocity.y *= -1;
         bola.velocity.mod *= 1.005;
      });

      var bola                     = screen.createElement("Arc");
      bola.type                    = "ball";
      bola.flutuate                = false;
      bola.bounce_when_colide_with = ["Block", "Border"];
      //bola.draw_colision_area           = true;
      bola.solid                   = false;
      bola.radius                  = 5;
      bola.velocity.ang            = (Math.random() - 0.5);
      //bola.velocity.ang            = Math.PI / 3 + Math.PI + Math.random();
      bola.velocity.mod            = +4;
      bola.x                       = screen.width / 2;
      bola.y                       = 440;
      //bola.draw_velocity           = true;

      bola.started = false;
      bola.stop();
      quad.on_move = function() {
         if(!bola.started) {
            bola.x = this.center.x;
         }
      };

      bola.on_colide_with("block", function(){this.velocity.mod *= 0.99});

      document.onclick = function() {
         bola.stopped = false;
         bola.started = true;
      };

      var mouseX = screen.width / 2;
      document.onmousemove = function(e) {
         mouseX = e.clientX;
      };
      setInterval(function(){
         if(mouseX > (quad.center.x - quad.width / 2)) {
            quad.velocity.x = mouseX - quad.center.x > 5 ? 5 : mouseX - quad.center.x;
         } else if(mouseX < (quad.center.x + quad.width / 2)) {
            quad.velocity.x = quad.center.x - mouseX > 5 ? -5 : -1 * (quad.center.x - mouseX);
         } else {
            quad.velocity.x = 0;
         }
      }, 10);

      Border.draw_colision_area         = true;
      Border.color                 = "AAAAAA";

      var borda1                   = screen.createElement("Border");
      borda1.x                     = screen.width - 5;

      var borda2                   = screen.createElement("Border");
      borda2.x                     = 5;

      var borda3                   = screen.createElement("Border");
      borda3.y                     = 30;

      var borda4                   = screen.createElement("Border");
      borda4.y                     = screen.height - 5;
      borda4.on_colide_with("ball", function(bola){ bola.destroy(); alert("You lose") });

      var block_counter = 0;

      var going2destroy = function(time) {
         if(this.height <= 3) {
            this.destroy();
         } else {
            this.resize(0.9);
            var _this = this;
            setTimeout(function(){_this.going2destroy(time)}, time);
         }
      };

      for(var j = 0; j < 3; j++) {
         var w = screen.width;
         var number_of_blocks = 25;
         var block_size       = 25;
         var blocks_space     = 5;
         var r = w - (number_of_blocks * block_size + (number_of_blocks - 1) * blocks_space);
         for(var i = r / 2; i < w - (r / 2); i += block_size + blocks_space) {
            var block                     = screen.createElement("Poligon");
            block_counter++;
            block.draw_colision_area      = false;
            block.solid                   = true;
            block.do_not_colide_with      = ["Border"];
            block.type                    = "Block";
            block.color                   = "000000";
            block.x                       = i + block_size / 2;
            block.y                       = 120 + j * 30;
            block.add_vertice(-13, 0);
            block.add_vertice(12, 0);
            block.add_vertice(12, 15);
            block.add_vertice(-13, 15);
            block.going2destroy = going2destroy;
            block.on_colide_with("ball", function(bola) { 
               score.add("block");
               block_counter--;
               var _this = this;
               //this.do_not_colide_with = ["ball"];
               this.on_colide_with("ball", function(){});
               this.flutuate = false;
               this.going2destroy(150);
               this.velocity = bola.original_velocity.clone();
               this.velocity.mod *= 0.1;
               if(block_counter <= 0) {
                  var _this = this;
                  setTimeout(function(){alert("You Win!"); _this._element_factory.screen.stop = true;}, 100);
               }
            });
         }
      }

      var ghost = screen.createElement("Poligon");
      ghost.visible                 = true;
      ghost.color                   = "888888";
      ghost.draw_colision_area      = false;
      ghost.do_not_colide_with      = ["Border"];
      ghost.type                    = "Block";
      ghost.color                   = "888888";
      ghost.x                       = screen.width / 2;
      ghost.y                       = 40;
      ghost.add_vertice(-13, 0);
      ghost.add_vertice(12, 0);
      ghost.add_vertice(12, 15);
      ghost.add_vertice(-13, 15);

      ghost.going2destroy = going2destroy;

      ghost.on_colide_with("ball", function(bola) { 
         clearInterval(this.blink_id);
         score.add("ghost");
         this.do_not_colide_with = ["ball"];
         this.going2destroy();
         if(block_counter <= 0) {
            var _this = this;
            setTimeout(function(){alert("You Win!"); _this._element_factory.screen.stop = true;}, 100);
         }
      });

      ghost.blink_id = setInterval(function(){
         if(ghost.visible) {
            ghost.do_not_colide_with      = ["Border", "ball"];
         } else {
            ghost.do_not_colide_with      = ["Border"];
         }
         ghost.visible = ! ghost.visible;
      }, 5000);

      screen.run();
    </script>
  </body>
</html>
